# Data Model: Backend Foundation - Todo API

**Feature**: 001-backend-foundation
**Date**: 2026-02-04
**Source**: spec.md Key Entities section

---

## Entity Overview

```
┌─────────────────┐         ┌─────────────────┐
│      User       │ 1     * │      Task       │
├─────────────────┤─────────├─────────────────┤
│ id (PK)         │         │ id (PK)         │
│ email           │         │ title           │
│ name            │         │ description     │
│ created_at      │         │ is_completed    │
└─────────────────┘         │ created_at      │
                            │ user_id (FK)?   │
                            └─────────────────┘

Note: User-Task relationship defined but user_id is nullable for M1.
User isolation is OUT OF SCOPE until Milestone 2.
```

---

## Entity: Task

**Purpose**: Represents a todo item in the application.

### Fields

| Field | Type | Constraints | Default | Description |
|-------|------|-------------|---------|-------------|
| id | Integer | PRIMARY KEY, AUTO INCREMENT | Generated | Unique identifier |
| title | String(255) | NOT NULL, max 255 chars | Required | Task title |
| description | String(2000) | NULLABLE, max 2000 chars | None | Optional task details |
| is_completed | Boolean | NOT NULL | False | Completion status |
| created_at | DateTime | NOT NULL | UTC now | Creation timestamp |
| user_id | Integer | NULLABLE, FK → User.id | None | Owner (M2 feature) |

### Validation Rules (from FR-007)

- `title`: Required, non-empty, max 255 characters
- `description`: Optional, max 2000 characters if provided
- `is_completed`: Must be boolean if provided in update

### State Transitions

```
[Created] ──(update is_completed=true)──> [Completed]
    │                                          │
    │                                          │
    └──────(update is_completed=false)─────────┘
```

### SQLModel Definition

```python
from sqlmodel import SQLModel, Field
from datetime import datetime
from typing import Optional

class TaskBase(SQLModel):
    """Base task fields shared between create/read/update."""
    title: str = Field(max_length=255, min_length=1)
    description: Optional[str] = Field(default=None, max_length=2000)
    is_completed: bool = Field(default=False)

class Task(TaskBase, table=True):
    """Database table model for tasks."""
    id: Optional[int] = Field(default=None, primary_key=True)
    created_at: datetime = Field(default_factory=datetime.utcnow)
    user_id: Optional[int] = Field(default=None, foreign_key="user.id")

class TaskCreate(SQLModel):
    """Schema for creating a new task."""
    title: str = Field(max_length=255, min_length=1)
    description: Optional[str] = Field(default=None, max_length=2000)

class TaskUpdate(SQLModel):
    """Schema for updating an existing task (all fields optional)."""
    title: Optional[str] = Field(default=None, max_length=255, min_length=1)
    description: Optional[str] = Field(default=None, max_length=2000)
    is_completed: Optional[bool] = None

class TaskRead(TaskBase):
    """Schema for reading/returning a task."""
    id: int
    created_at: datetime
```

---

## Entity: User (Stub for M2)

**Purpose**: Represents a system user. Created for schema preparation but NOT actively used in Milestone 1.

### Fields

| Field | Type | Constraints | Default | Description |
|-------|------|-------------|---------|-------------|
| id | Integer | PRIMARY KEY, AUTO INCREMENT | Generated | Unique identifier |
| email | String(255) | NOT NULL, UNIQUE | Required | User email address |
| name | String(255) | NULLABLE | None | Display name |
| created_at | DateTime | NOT NULL | UTC now | Account creation time |

### SQLModel Definition

```python
class User(SQLModel, table=True):
    """Database table model for users (M2 preparation)."""
    id: Optional[int] = Field(default=None, primary_key=True)
    email: str = Field(max_length=255, unique=True, index=True)
    name: Optional[str] = Field(default=None, max_length=255)
    created_at: datetime = Field(default_factory=datetime.utcnow)
```

**Note**: No CRUD endpoints for User in M1. Table will be created but remain empty.

---

## Relationships

### User → Task (One-to-Many)

- **Cardinality**: One User can have many Tasks
- **Foreign Key**: `Task.user_id` references `User.id`
- **On Delete**: CASCADE (delete user's tasks when user deleted) - M2 consideration
- **M1 Behavior**: `user_id` is nullable, all tasks are "global"

---

## Database Schema (PostgreSQL)

```sql
-- Auto-generated by SQLModel's create_all()

CREATE TABLE "user" (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) NOT NULL UNIQUE,
    name VARCHAR(255),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE task (
    id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description VARCHAR(2000),
    is_completed BOOLEAN NOT NULL DEFAULT FALSE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    user_id INTEGER REFERENCES "user"(id)
);

CREATE INDEX ix_user_email ON "user"(email);
CREATE INDEX ix_task_user_id ON task(user_id);
CREATE INDEX ix_task_created_at ON task(created_at DESC);
```

---

## API Schema Summary

| Operation | Input Schema | Output Schema |
|-----------|--------------|---------------|
| POST /api/tasks | TaskCreate | TaskRead |
| GET /api/tasks | None | List[TaskRead] |
| GET /api/tasks/{id} | Path param: id | TaskRead |
| PUT /api/tasks/{id} | TaskUpdate | TaskRead |
| DELETE /api/tasks/{id} | Path param: id | None (204) |

---

## Validation Error Format

When validation fails (FR-007), response follows FastAPI's standard:

```json
{
  "detail": [
    {
      "type": "string_too_long",
      "loc": ["body", "title"],
      "msg": "String should have at most 255 characters",
      "input": "...",
      "ctx": {"max_length": 255}
    }
  ]
}
```
